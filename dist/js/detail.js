"use strict";!function(){var e,t,u,d,f,p;$("#ajax_top").load("modelhtml/top.html"),$("#ajax_header").load("modelhtml/main_header.html"),e="fdj",t=document.getElementById(e),u=t.firstElementChild,d=t.lastElementChild,f=u.lastElementChild,p=d.lastElementChild,u.onmouseenter=function(){f.style.display="block",d.style.display="block"},u.onmouseleave=function(){f.style.display="none",d.style.display="none"},u.onmousemove=function(e){var t=e.clientX,n=e.clientY,i=u.offsetLeft,o=u.offsetTop,c=t-i-f.offsetWidth/2,a=n-o-f.offsetHeight/2;c<=0?c=0:c>=u.offsetWidth-f.offsetWidth&&(c=u.offsetWidth-f.offsetWidth),a<=0?a=0:a>=u.offsetHeight-f.offsetHeight&&(a=u.offsetHeight-f.offsetHeight),f.style.left=c+"px",f.style.top=a+"px";var l=c/(u.offsetWidth-f.offsetWidth),r=a/(u.offsetHeight-f.offsetHeight),s=p.offsetWidth-d.offsetWidth,m=p.offsetHeight-d.offsetHeight;p.style.left=-s*l+"px",p.style.top=-m*r+"px"};var a=document.getElementById("picimg"),l=document.getElementById("bigimg"),n=document.getElementsByClassName("picul")[0];n.children;n.onmouseover=function(e){var t=e.target.src;a.src=t,l.src=t};var r=decodeURI(location.search).slice(1),s=document.getElementsByClassName("picul")[0],m=(a=document.getElementById("picimg"),l=document.getElementById("bigimg"),document.getElementById("goods_name")),h=document.querySelector(".now_price"),g=document.querySelector(".prev_price"),v=document.querySelector(".fhd_where"),y=document.querySelector("#goods_id"),_=document.querySelector("#kc_num"),H=document.querySelector(".js_price");function x(e){var t=document.cookie.split("; "),n=!0,i=!1,o=void 0;try{for(var c,a=t[Symbol.iterator]();!(n=(c=a.next()).done);n=!0){var l=c.value.split("=");if(e==l[0])return l[1]}}catch(e){i=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}}new Promise(function(t){$.ajax({type:"get",url:"../api/detail.php",data:{gid:r},success:function(e){t(e)}})}).then(function(e){var n=JSON.parse(e)[0];console.log(n),m.innerHTML=n.name,h.innerHTML="¥"+(1*n.now_price).toFixed(2),g.innerHTML="¥"+(1*n.prev_price).toFixed(2),v.innerHTML=n.place,y.innerHTML=n.gcode,_.innerHTML=n.num,H.innerHTML="¥"+(n.prev_price-n.now_price).toFixed(2);var t=n.imgUrl.split(","),i=t.map(function(e){return'<img src="../d_image/'+~~n.gid+"/"+e+'">'}).join("");a.src="../d_image/"+~~n.gid+"/"+t[0],l.src="../d_image/"+~~n.gid+"/"+t[0],s.innerHTML=i,$(".picul img").eq(0).attr("class","active"),$(".picul img").on("mouseenter",function(){$(this).attr("class","active").siblings().attr("class","")});var o=0,c=0;new Promise(function(t){$.ajax({type:"post",url:"../api/addcar.php",data:{userphone:x("login"),gid:r,num:""},success:function(e){""==e||($("#car_num").html(e),o=e-0)}}),$.ajax({type:"post",url:"../api/kucun.php",data:{userphone:x("login"),gid:r},success:function(e){c=e-0,t(e)}})}).then(function(e){if(x("login")){var t=n.num-c;_.innerHTML=t<=0?0:t}$(".select_num").on("click",".add",function(){var e=$("#kc_num").html(),t=$(this).prev().val();e<=++t&&(t=0<e?e:1),$(this).prev().val(t)}),$(".select_num").on("click",".minus",function(){$("#kc_num").html();var e=$(this).next().val();--e<=1&&(e=1),$(this).next().val(e)}),$(".select_num").on("input click","input",function(){var e=$("#kc_num").html(),t=$(this).val()-0;t<=1?t=1:e<=t&&(t=0<e?e:1),$(this).val(t)});var i=!0;$("#add_car").on("click",function(){var e=$("#kc_num").html();if(e=$("#kc_num").html()-0,x("login")){if(i){i=!1;var t=$(".select_num input").val();if(e<t)$(".select_num input").val(1),alert("库存不足"),i=!0;else{$("#kc_num").html(e-t),o+=t-0;var n=document.createElement("img");n.className="car_img",n.src=$("#picimg").attr("src"),document.body.appendChild(n),$(".car_img").animate({marginLeft:570,marginTop:270},600,function(){i=!0,$(".car_img").animate({marginTop:320,opacity:0},400,function(){$(this).remove()})}),$("#car_num").html(o),$.ajax({type:"post",url:"../api/addcar.php",data:{userphone:x("login"),gid:r,num:t},success:function(e){}})}}}else alert("你还没有登录呢")})})})}();